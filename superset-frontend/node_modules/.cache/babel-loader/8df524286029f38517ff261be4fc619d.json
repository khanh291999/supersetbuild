{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport { useSingleViewResource } from 'src/views/CRUD/hooks';\nimport Icons from 'src/components/Icons';\nimport { StyledIcon } from 'src/views/CRUD/utils';\nimport Modal from 'src/components/Modal';\nimport withToasts from 'src/components/MessageToasts/withToasts';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst StyledAnnotationLayerTitle = styled.div`\n  margin: ${({ theme }) => theme.gridUnit * 2}px auto\n    ${({ theme }) => theme.gridUnit * 4}px auto;\n`;\nconst LayerContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 10}px;\n\n  .control-label {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  .required {\n    margin-left: ${({ theme }) => theme.gridUnit / 2}px;\n    color: ${({ theme }) => theme.colors.error.base};\n  }\n\n  textarea,\n  input[type='text'] {\n    padding: ${({ theme }) => theme.gridUnit * 1.5}px\n      ${({ theme }) => theme.gridUnit * 2}px;\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-radius: ${({ theme }) => theme.gridUnit}px;\n    width: 50%;\n  }\n\n  input,\n  textarea {\n    flex: 1 1 auto;\n  }\n\n  textarea {\n    width: 100%;\n    height: 160px;\n    resize: none;\n  }\n\n  input::placeholder,\n  textarea::placeholder {\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\nconst AnnotationLayerModal = ({ addDangerToast, onLayerAdd, onHide, show, layer = null }) => {\n  const [disableSave, setDisableSave] = useState(true);\n  const [currentLayer, setCurrentLayer] = useState();\n  const [isHidden, setIsHidden] = useState(true);\n  const isEditMode = layer !== null;\n  // annotation layer fetch logic\n  const { state: { loading, resource }, fetchResource, createResource, updateResource } = useSingleViewResource('annotation_layer', t('annotation_layer'), addDangerToast);\n  const resetLayer = () => {\n    // Reset layer\n    setCurrentLayer({\n      name: '',\n      descr: '' });\n\n  };\n  // Functions\n  const hide = () => {\n    setIsHidden(true);\n    // Reset layer\n    resetLayer();\n    onHide();\n  };\n  const onSave = () => {\n    if (isEditMode) {\n      // Edit\n      if (currentLayer && currentLayer.id) {\n        const update_id = currentLayer.id;\n        delete currentLayer.id;\n        delete currentLayer.created_by;\n        updateResource(update_id, currentLayer).then((response) => {\n          if (!response) {\n            return;\n          }\n          hide();\n        });\n      }\n    } else\n    if (currentLayer) {\n      // Create\n      createResource(currentLayer).then((response) => {\n        if (!response) {\n          return;\n        }\n        if (onLayerAdd) {\n          onLayerAdd(response);\n        }\n        hide();\n      });\n    }\n  };\n  const onTextChange = (event) => {\n    const { target } = event;\n    const data = {\n      ...currentLayer,\n      name: currentLayer ? currentLayer.name : '',\n      descr: currentLayer ? currentLayer.descr : '' };\n\n    data[target.name] = target.value;\n    setCurrentLayer(data);\n  };\n  const validate = () => {\n    if (currentLayer && currentLayer.name.length) {\n      setDisableSave(false);\n    } else\n    {\n      setDisableSave(true);\n    }\n  };\n  // Initialize\n  useEffect(() => {\n    if (isEditMode && (\n    !currentLayer ||\n    !currentLayer.id ||\n    layer && layer.id !== currentLayer.id ||\n    isHidden && show)) {\n      if (show && layer && layer.id !== null && !loading) {\n        const id = layer.id || 0;\n        fetchResource(id);\n      }\n    } else\n    if (!isEditMode && (\n    !currentLayer || currentLayer.id || isHidden && show)) {\n      // Reset layer\n      resetLayer();\n    }\n  }, [layer, show]);\n  useEffect(() => {\n    if (resource) {\n      setCurrentLayer(resource);\n    }\n  }, [resource]);\n  // Validation\n  useEffect(() => {\n    validate();\n  }, [\n  currentLayer ? currentLayer.name : '',\n  currentLayer ? currentLayer.descr : '']);\n\n  // Show/hide\n  if (isHidden && show) {\n    setIsHidden(false);\n  }\n  return ___EmotionJSX(Modal, { disablePrimaryButton: disableSave, onHandledPrimaryAction: onSave, onHide: hide, primaryButtonName: isEditMode ? t('Save') : t('Add'), show: show, width: \"55%\", title: ___EmotionJSX(\"h4\", null,\n    isEditMode ? ___EmotionJSX(Icons.EditAlt, { css: StyledIcon }) : ___EmotionJSX(Icons.PlusLarge, { css: StyledIcon }),\n    isEditMode ?\n    t('Edit annotation layer properties') :\n    t('Add annotation layer')) },\n\n  ___EmotionJSX(StyledAnnotationLayerTitle, null,\n  ___EmotionJSX(\"h4\", null, t('Basic information'))),\n\n  ___EmotionJSX(LayerContainer, null,\n  ___EmotionJSX(\"div\", { className: \"control-label\" },\n  t('Annotation layer name'),\n  ___EmotionJSX(\"span\", { className: \"required\" }, \"*\")),\n\n  ___EmotionJSX(\"input\", { name: \"name\", onChange: onTextChange, type: \"text\", value: currentLayer == null ? void 0 : currentLayer.name })),\n\n  ___EmotionJSX(LayerContainer, null,\n  ___EmotionJSX(\"div\", { className: \"control-label\" }, t('description')),\n  ___EmotionJSX(\"textarea\", { name: \"descr\", value: currentLayer == null ? void 0 : currentLayer.descr, placeholder: t('Description (this can be seen in the list)'), onChange: onTextChange })));\n\n\n};\nexport default withToasts(AnnotationLayerModal);","map":null,"metadata":{},"sourceType":"module"}