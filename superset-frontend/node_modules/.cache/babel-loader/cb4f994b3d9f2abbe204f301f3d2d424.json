{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\nconst FilterControls = ({ directPathToChild, dataMaskSelected, onFilterSelectionChange }) => {\n  const [visiblePopoverId, setVisiblePopoverId] = useState(null);\n  const filters = useFilters();\n  const filterValues = Object.values(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = filterValues.map((filter) => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id] }));\n\n    return buildCascadeFiltersTree(filtersWithValue);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [JSON.stringify(filterValues), dataMaskSelected]);\n  const cascadeFilterIds = new Set(cascadeFilters.map((item) => item.id));\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(cascadeFilters);\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n  return ___EmotionJSX(Wrapper, null,\n  portalNodes.\n  filter((node, index) => cascadeFilterIds.has(filterValues[index].id)).\n  map((node, index) => ___EmotionJSX(portals.InPortal, { node: node },\n  ___EmotionJSX(CascadePopover, { key: cascadeFilters[index].id, dataMaskSelected: dataMaskSelected, visible: visiblePopoverId === cascadeFilters[index].id, onVisibleChange: (visible) => setVisiblePopoverId(visible ? cascadeFilters[index].id : null), filter: cascadeFilters[index], onFilterSelectionChange: onFilterSelectionChange, directPathToChild: directPathToChild, inView: false }))),\n\n  filtersInScope.map((filter) => {\n    const index = filterValues.findIndex((f) => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true });\n  }),\n  showCollapsePanel && ___EmotionJSX(Collapse, { ghost: true, bordered: true, expandIconPosition: \"right\", collapsible: filtersOutOfScope.length === 0 ? 'disabled' : undefined, css: (theme) => /*#__PURE__*/css(\"&.ant-collapse{margin-top:\",\n\n    filtersInScope.length > 0 ?\n    theme.gridUnit * 6 :\n    0, \"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:\",\n\n\n\n    theme.gridUnit * 2, \"px;&>.ant-collapse-arrow{right:\",\n\n\n    theme.gridUnit, \"px;}}& .ant-collapse-content-box{padding:\",\n\n\n\n\n    theme.gridUnit * 4, \"px 0 0;}}}\" + (process.env.NODE_ENV === \"production\" ? \"\" : \";label:FilterControls;\"), process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zdXBlcnNldC1mcm9udGVuZC9zcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvbmF0aXZlRmlsdGVycy9GaWx0ZXJCYXIvRmlsdGVyQ29udHJvbHMvRmlsdGVyQ29udHJvbHMudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWtFeUsiLCJmaWxlIjoiL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9uYXRpdmVGaWx0ZXJzL0ZpbHRlckJhci9GaWx0ZXJDb250cm9scy9GaWx0ZXJDb250cm9scy50c3giLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUmVhY3QsIHsgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBzdHlsZWQsIHQgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBjc3MgfSBmcm9tICdAZW1vdGlvbi9yZWFjdCc7XG5pbXBvcnQgKiBhcyBwb3J0YWxzIGZyb20gJ3JlYWN0LXJldmVyc2UtcG9ydGFsJztcbmltcG9ydCB7IENvbGxhcHNlIH0gZnJvbSAnc3JjL2NvbW1vbi9jb21wb25lbnRzJztcbmltcG9ydCBDYXNjYWRlUG9wb3ZlciBmcm9tICcuLi9DYXNjYWRlRmlsdGVycy9DYXNjYWRlUG9wb3Zlcic7XG5pbXBvcnQgeyBidWlsZENhc2NhZGVGaWx0ZXJzVHJlZSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgdXNlRmlsdGVycyB9IGZyb20gJy4uL3N0YXRlJztcbmltcG9ydCB7IHVzZURhc2hib2FyZEhhc1RhYnMsIHVzZVNlbGVjdEZpbHRlcnNJblNjb3BlIH0gZnJvbSAnLi4vLi4vc3RhdGUnO1xuY29uc3QgV3JhcHBlciA9IHN0eWxlZC5kaXYgYFxuICBwYWRkaW5nOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogNH1weDtcbiAgJjpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICB9XG5gO1xuY29uc3QgRmlsdGVyQ29udHJvbHMgPSAoeyBkaXJlY3RQYXRoVG9DaGlsZCwgZGF0YU1hc2tTZWxlY3RlZCwgb25GaWx0ZXJTZWxlY3Rpb25DaGFuZ2UsIH0pID0+IHtcbiAgICBjb25zdCBbdmlzaWJsZVBvcG92ZXJJZCwgc2V0VmlzaWJsZVBvcG92ZXJJZF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICBjb25zdCBmaWx0ZXJzID0gdXNlRmlsdGVycygpO1xuICAgIGNvbnN0IGZpbHRlclZhbHVlcyA9IE9iamVjdC52YWx1ZXMoZmlsdGVycyk7XG4gICAgY29uc3QgcG9ydGFsTm9kZXMgPSBSZWFjdC51c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3Qgbm9kZXMgPSBuZXcgQXJyYXkoZmlsdGVyVmFsdWVzLmxlbmd0aCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyVmFsdWVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBub2Rlc1tpXSA9IHBvcnRhbHMuY3JlYXRlSHRtbFBvcnRhbE5vZGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9kZXM7XG4gICAgfSwgW2ZpbHRlclZhbHVlcy5sZW5ndGhdKTtcbiAgICBjb25zdCBjYXNjYWRlRmlsdGVycyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICBjb25zdCBmaWx0ZXJzV2l0aFZhbHVlID0gZmlsdGVyVmFsdWVzLm1hcChmaWx0ZXIgPT4gKHtcbiAgICAgICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgICAgIGRhdGFNYXNrOiBkYXRhTWFza1NlbGVjdGVkW2ZpbHRlci5pZF0sXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIGJ1aWxkQ2FzY2FkZUZpbHRlcnNUcmVlKGZpbHRlcnNXaXRoVmFsdWUpO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgfSwgW0pTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlcyksIGRhdGFNYXNrU2VsZWN0ZWRdKTtcbiAgICBjb25zdCBjYXNjYWRlRmlsdGVySWRzID0gbmV3IFNldChjYXNjYWRlRmlsdGVycy5tYXAoaXRlbSA9PiBpdGVtLmlkKSk7XG4gICAgY29uc3QgW2ZpbHRlcnNJblNjb3BlLCBmaWx0ZXJzT3V0T2ZTY29wZV0gPSB1c2VTZWxlY3RGaWx0ZXJzSW5TY29wZShjYXNjYWRlRmlsdGVycyk7XG4gICAgY29uc3QgZGFzaGJvYXJkSGFzVGFicyA9IHVzZURhc2hib2FyZEhhc1RhYnMoKTtcbiAgICBjb25zdCBzaG93Q29sbGFwc2VQYW5lbCA9IGRhc2hib2FyZEhhc1RhYnMgJiYgY2FzY2FkZUZpbHRlcnMubGVuZ3RoID4gMDtcbiAgICByZXR1cm4gKDxXcmFwcGVyPlxuICAgICAge3BvcnRhbE5vZGVzXG4gICAgICAgICAgICAuZmlsdGVyKChub2RlLCBpbmRleCkgPT4gY2FzY2FkZUZpbHRlcklkcy5oYXMoZmlsdGVyVmFsdWVzW2luZGV4XS5pZCkpXG4gICAgICAgICAgICAubWFwKChub2RlLCBpbmRleCkgPT4gKDxwb3J0YWxzLkluUG9ydGFsIG5vZGU9e25vZGV9PlxuICAgICAgICAgICAgPENhc2NhZGVQb3BvdmVyIGRhdGEtdGVzdD1cImNhc2NhZGUtZmlsdGVycy1jb250cm9sXCIga2V5PXtjYXNjYWRlRmlsdGVyc1tpbmRleF0uaWR9IGRhdGFNYXNrU2VsZWN0ZWQ9e2RhdGFNYXNrU2VsZWN0ZWR9IHZpc2libGU9e3Zpc2libGVQb3BvdmVySWQgPT09IGNhc2NhZGVGaWx0ZXJzW2luZGV4XS5pZH0gb25WaXNpYmxlQ2hhbmdlPXt2aXNpYmxlID0+IHNldFZpc2libGVQb3BvdmVySWQodmlzaWJsZSA/IGNhc2NhZGVGaWx0ZXJzW2luZGV4XS5pZCA6IG51bGwpfSBmaWx0ZXI9e2Nhc2NhZGVGaWx0ZXJzW2luZGV4XX0gb25GaWx0ZXJTZWxlY3Rpb25DaGFuZ2U9e29uRmlsdGVyU2VsZWN0aW9uQ2hhbmdlfSBkaXJlY3RQYXRoVG9DaGlsZD17ZGlyZWN0UGF0aFRvQ2hpbGR9IGluVmlldz17ZmFsc2V9Lz5cbiAgICAgICAgICA8L3BvcnRhbHMuSW5Qb3J0YWw+KSl9XG4gICAgICB7ZmlsdGVyc0luU2NvcGUubWFwKGZpbHRlciA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGZpbHRlclZhbHVlcy5maW5kSW5kZXgoZiA9PiBmLmlkID09PSBmaWx0ZXIuaWQpO1xuICAgICAgICAgICAgcmV0dXJuIDxwb3J0YWxzLk91dFBvcnRhbCBub2RlPXtwb3J0YWxOb2Rlc1tpbmRleF19IGluVmlldy8+O1xuICAgICAgICB9KX1cbiAgICAgIHtzaG93Q29sbGFwc2VQYW5lbCAmJiAoPENvbGxhcHNlIGdob3N0IGJvcmRlcmVkIGV4cGFuZEljb25Qb3NpdGlvbj1cInJpZ2h0XCIgY29sbGFwc2libGU9e2ZpbHRlcnNPdXRPZlNjb3BlLmxlbmd0aCA9PT0gMCA/ICdkaXNhYmxlZCcgOiB1bmRlZmluZWR9IGNzcz17dGhlbWUgPT4gY3NzIGBcbiAgICAgICAgICAgICYuYW50LWNvbGxhcHNlIHtcbiAgICAgICAgICAgICAgbWFyZ2luLXRvcDogJHtmaWx0ZXJzSW5TY29wZS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgPyB0aGVtZS5ncmlkVW5pdCAqIDZcbiAgICAgICAgICAgICAgICA6IDB9cHg7XG4gICAgICAgICAgICAgICYgPiAuYW50LWNvbGxhcHNlLWl0ZW0ge1xuICAgICAgICAgICAgICAgICYgPiAuYW50LWNvbGxhcHNlLWhlYWRlciB7XG4gICAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDA7XG4gICAgICAgICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogJHt0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG5cbiAgICAgICAgICAgICAgICAgICYgPiAuYW50LWNvbGxhcHNlLWFycm93IHtcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQ6ICR7dGhlbWUuZ3JpZFVuaXR9cHg7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJiAuYW50LWNvbGxhcHNlLWNvbnRlbnQtYm94IHtcbiAgICAgICAgICAgICAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiA0fXB4IDAgMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBgfT5cbiAgICAgICAgICA8Q29sbGFwc2UuUGFuZWwgaGVhZGVyPXtgJHt0KCdGaWx0ZXJzIG91dCBvZiBzY29wZScpfSAoJHtmaWx0ZXJzT3V0T2ZTY29wZS5sZW5ndGh9KWB9IGtleT1cIjFcIj5cbiAgICAgICAgICAgIHtmaWx0ZXJzT3V0T2ZTY29wZS5tYXAoZmlsdGVyID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNhc2NhZGVGaWx0ZXJzLmZpbmRJbmRleChmID0+IGYuaWQgPT09IGZpbHRlci5pZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxwb3J0YWxzLk91dFBvcnRhbCBub2RlPXtwb3J0YWxOb2Rlc1tpbmRleF19IGluVmlldy8+O1xuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgPC9Db2xsYXBzZS5QYW5lbD5cbiAgICAgICAgPC9Db2xsYXBzZT4pfVxuICAgIDwvV3JhcHBlcj4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IEZpbHRlckNvbnRyb2xzO1xuIl19 */\") },\n\n\n\n\n  ___EmotionJSX(Collapse.Panel, { header: `${t('Filters out of scope')} (${filtersOutOfScope.length})`, key: \"1\" },\n  filtersOutOfScope.map((filter) => {\n    const index = cascadeFilters.findIndex((f) => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true });\n  }))));\n\n\n\n};\nexport default FilterControls;","map":null,"metadata":{},"sourceType":"module"}