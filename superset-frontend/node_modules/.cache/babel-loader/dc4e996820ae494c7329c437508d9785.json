{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css, t } from '@superset-ui/core';\nimport { Select } from 'src/components';\nimport ControlHeader from 'src/explore/components/ControlHeader';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  ariaLabel: PropTypes.string,\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.string,\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n  PropTypes.string,\n  PropTypes.number,\n  PropTypes.array]),\n\n  default: PropTypes.oneOfType([\n  PropTypes.string,\n  PropTypes.number,\n  PropTypes.array]),\n\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  filterOption: PropTypes.func,\n\n  // ControlHeader props\n  label: PropTypes.string,\n  renderTrigger: PropTypes.bool,\n  validationErrors: PropTypes.array,\n  rightNode: PropTypes.node,\n  leftNode: PropTypes.node,\n  onClick: PropTypes.func,\n  hovered: PropTypes.bool,\n  tooltipOnClick: PropTypes.func,\n  warning: PropTypes.string,\n  danger: PropTypes.string };\n\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value' };\n\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props) };\n\n    this.onChange = this.onChange.bind(this);\n    this.handleFilterOptions = this.handleFilterOptions.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n    nextProps.choices !== this.props.choices ||\n    nextProps.options !== this.props.options)\n    {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(val) {\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    const { valueKey } = this.props;\n    let onChangeVal = val;\n\n    if (Array.isArray(val)) {\n      const values = val.map((v) => (v == null ? void 0 : v[valueKey]) || v);\n      onChangeVal = values;\n    }\n    if (typeof val === 'object' && val != null && val[valueKey]) {\n      onChangeVal = val[valueKey];\n    }\n    this.props.onChange(onChangeVal, []);\n  }\n\n  getOptions(props) {\n    const { choices, optionRenderer, valueKey } = props;\n    let options = [];\n    if (props.options) {\n      options = props.options.map((o) => ({\n        ...o,\n        value: o[valueKey],\n        label: o.label || o[valueKey],\n        customLabel: optionRenderer ? optionRenderer(o) : undefined }));\n\n    } else if (choices) {\n      // Accepts different formats of input\n      options = choices.map((c) => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return {\n            value,\n            label };\n\n        }\n        if (Object.is(c)) {\n          return {\n            ...c,\n            value: c[valueKey],\n            label: c.label || c[valueKey] };\n\n        }\n        return { value: c, label: c };\n      });\n    }\n    return options;\n  }\n\n  handleFilterOptions(text, option) {\n    const { filterOption } = this.props;\n    return filterOption({ data: option }, text);\n  }\n\n  render() {\n    const {\n      ariaLabel,\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      freeForm,\n      isLoading,\n      isMulti,\n      label,\n      multi,\n      name,\n      placeholder,\n      onFocus,\n      optionRenderer,\n      showHeader,\n      value,\n      // ControlHeader props\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger } =\n    this.props;\n\n    const headerProps = {\n      name,\n      label,\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger };\n\n\n    const getValue = () => {\n      const currentValue =\n      value || (\n      this.props.default !== undefined ? this.props.default : undefined);\n\n      // safety check - the value is intended to be undefined but null was used\n      if (\n      currentValue === null &&\n      !this.state.options.find((o) => o.value === null))\n      {\n        return undefined;\n      }\n      return currentValue;\n    };\n\n    const selectProps = {\n      allowNewOptions: freeForm,\n      autoFocus,\n      ariaLabel:\n      ariaLabel || (typeof label === 'string' ? label : t('Select ...')),\n      allowClear: clearable,\n      disabled,\n      filterOption:\n      filterOption && typeof filterOption === 'function' ?\n      this.handleFilterOptions :\n      true,\n      header: showHeader && ___EmotionJSX(ControlHeader, headerProps),\n      loading: isLoading,\n      mode: isMulti || multi ? 'multiple' : 'single',\n      name: `select-${name}`,\n      onChange: this.onChange,\n      onFocus,\n      optionRenderer,\n      options: this.state.options,\n      placeholder,\n      value: getValue() };\n\n\n    return (\n      ___EmotionJSX(\"div\", {\n        css: (theme) => css`\n          .type-label {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          .Select__multi-value__label > span,\n          .Select__option > span,\n          .Select__single-value > span {\n            display: flex;\n            align-items: center;\n          }\n        ` },\n\n      ___EmotionJSX(Select, selectProps)));\n\n\n  }}\n\n\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;","map":null,"metadata":{},"sourceType":"module"}